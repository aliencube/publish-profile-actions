name: Build & Test

on: [ push, pull_request ]

jobs:
  build_and_test:
    name: 'Build & Test'

    runs-on: ubuntu-latest

    steps:
    - name: Checkout the repo
      uses: actions/checkout@v2

    - name: Login to Azure
      uses: Azure/login@v1.1
      with:
        creds: ${{ secrets.AZURE_CREDENTIALS }}

    - name: Get WebApp publish profile
      id: webapp
      uses: ./
      with:
        resourceGroupName: ${{ secrets.RESOURCE_GROUP_NAME }}
        appName: ${{ secrets.WEBAPP_NAME }}
        isFunctionApp: false

    - name: Get FunctionApp publish profile
      id: fncapp
      uses: ./
      with:
        resourceGroupName: ${{ secrets.RESOURCE_GROUP_NAME }}
        appName: ${{ secrets.FUNCTIONAPP_NAME }}
        isFunctionApp: true

    - name: Show Profile
      shell: bash
      run: |
        echo "WebApp: ${{ steps.webapp.outputs.profile }}"
        echo "FunctionApp: ${{ steps.fncapp.outputs.profile }}"
